"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var React=_interopDefault(require("react")),reactDom=require("react-dom"),PropTypes=_interopDefault(require("prop-types")),computeLayout=_interopDefault(require("css-layout")),classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},Flexbox=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._shouldUpdateAgain=!1,e.state={layout:{children:[]}},e}return inherits(t,e),createClass(t,[{key:"componentDidMount",value:function(){this.forceUpdate()}},{key:"componentDidUpdate",value:function(){if(this._shouldUpdateAgain=!this._shouldUpdateAgain,this._shouldUpdateAgain){var e=this.getChildrenMeasured(this._childRefs),t=this.getChildren(this.props.children),r=this.getChildrenAsMergedStyles(t,e),n=this.getComputedLayout(r,this.props.style);this.props.onLayout(n),this.setState({layout:n})}}},{key:"getChildren",value:function(e){return e.map(function(e){return Array.isArray(e)?e:[e]}).reduce(function(e,t){return e.concat(t)},[])}},{key:"getChildrenAsMergedStyles",value:function(e,t){return t.map(function(t,r){var n=e[r]||{},o=n&&n.props?n.props.style:{};return{style:_extends({},o,{height:t.height||o.height,width:t.width||o.width})}})}},{key:"getChildrenMeasured",value:function(e){return e&&e.length?e.map(function(e){return e.getBBox?e.getBBox():reactDom.findDOMNode(e).getBBox()}):[]}},{key:"getComputedLayout",value:function(e,t){var r={children:[].concat(toConsumableArray(e||[])),style:_extends({},t)};return computeLayout(r),r}},{key:"getLayoutChildren",value:function(e){return e&&e.children&&e.children.length?e.children:[]}},{key:"getLayoutAttributesForChild",value:function(e,t){if(t&&t.layout){var r=t.layout,n=r.left,o=r.top;switch(e.type){case"circle":var a=e.props.r||0;return{cx:n+a,cy:o+a};case"ellipse":return{cx:n+(e.props.rx||0),cy:o+(e.props.ry||0)};case"g":case"path":case"polygon":case"polyline":return{transform:"translate("+n+" "+o+")"};default:return{x:n,y:o}}}return{}}},{key:"render",value:function(){var e=this;this._childRefs=[];var t=this.getChildren(this.props.children),r=this.getLayoutChildren(this.state.layout);return React.createElement("g",{className:this.props.className,transform:"translate("+this.props.x+" "+this.props.y+")"},t.map(function(t,n){return React.cloneElement(t,_extends({},t.props,e.getLayoutAttributesForChild(t,r[n]),{key:"flexboxChild"+n,ref:function(t){return t?e._childRefs.push(t):null}}))}))}}]),t}(React.Component);Flexbox.propTypes={children:PropTypes.array,className:PropTypes.string,onLayout:PropTypes.func,style:PropTypes.object,x:PropTypes.number,y:PropTypes.number},Flexbox.defaultProps={children:[],className:null,onLayout:function(){},style:{},x:0,y:0},module.exports=Flexbox;
